name: tagger_all_aps
on:
    push:
        branches:
            - dev
            - main
        paths:
            - libraries/**
jobs:
  # JOB to run change detection
  changes:
    runs-on: ubuntu-latest
    # Required permissions
    permissions:
      pull-requests: read
    outputs:
      # Expose matched filters as job 'packages' output variable
      libraries: ${{ steps.filter.outputs.changes }}
    steps:
    # For pull requests it's not necessary to checkout the code
    - uses: actions/checkout@v4
    - uses: dorny/paths-filter@v3
      id: filter
      with:
        filters: |
          libraries: libraries/**
  # JOB to tag the application
  tag:
      needs: changes
      if: ${{ needs.changes.outputs.libraries == 'true' }}
      runs-on: ubuntu-latest
      strategy:
        matrix:
          # Parse JSON array containing names of all filters matching any of changed files
          # e.g. ['package1', 'package2'] if both package folders contains changes
          library: ${{ fromJSON(needs.changes.outputs.libraries) }}
      steps:
        - name: Get branch name
          id: branch-name
          uses: tj-actions/branch-name@v5.2
        - name: Dump matrix context
          env:
            MATRIX_CONTEXT: ${{ toJson(matrix) }}
          run: echo "$MATRIX_CONTEXT"
        #- name: Tag application
        #  uses: cotjoey/test-library-tagger/.github/workflows/tagger_core.yml@main
        #  with:
        #      path: libraries/${{ path }}
        #      branch: ${{ steps.branch-name.outputs.triggering_branch_output }}
        
